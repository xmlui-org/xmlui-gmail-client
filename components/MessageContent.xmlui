<Component name="MessageContent" var.iframeHeight="300">
    <AppState id="selectedMessage" bucket="appState" />

    <VStack height="100%">
        <!-- Header -->
        <VStack gap="0">
            <Text variant="strong" fontSize="x-large">
                { selectedMessage.value.subject || '(No Subject)' }
            </Text>

            <HStack wrapContent="true" gap="10px" verticalAlignment="center">
                <Text overflowMode="ellipsis">
                    <strong>
                        From:
                    </strong>
                    {selectedMessage.value.fromName}
                        {selectedMessage.value.fromEmail ? ' &lt;' + selectedMessage.value.fromEmail + '&gt;' : '' }
                </Text>
                <SpaceFiller />
                <Text fontSize="smaller" color="$textColor--disabled">
                    { formatDate(selectedMessage.value.date, "MMMM dd, yyyy 'at' HH:mm") }
                </Text>

            </HStack>

        </VStack>

        <!-- Divider -->
        <ContentSeparator
            orientation="horizontal"
            thickness="1px"
        />

        <!-- Message body -->
        <IFrame
            id="messageIframe"
            srcdoc="{ window.wrapEmailHtml(window.DOMPurify.sanitize(selectedMessage.value.body || '')) }"
            sandbox="allow-same-origin allow-popups allow-popups-to-escape-sandbox"
            height="{ iframeHeight + 'px' }"
            onLoad="{ () => {
                const doc = messageIframe.getContentDocument();
                if (doc && doc.body) {
                    iframeHeight = doc.body.scrollHeight + 20;
                }
            }}"
        />

        <!-- Action buttons -->
        <HStack
            horizontalAlignment="end"
        >
            <Button
                label="Reply"
                onClick="{ toast('Not implemented yet') }"
            />
        </HStack>
    </VStack>

</Component>
